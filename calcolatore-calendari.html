<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore Calendari Corsi 2026 - SONODIGITALE</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb;
            color: #111827;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .header {
            background: linear-gradient(to right, #111827, #1f2937);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header p {
            color: #d1d5db;
            margin-top: 0.5rem;
        }

        .section {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-cols-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-cols-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .template-card {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .template-card:hover {
            border-color: #fdba74;
        }

        .template-card.active {
            border-color: #FC7E15;
            background-color: #fff7ed;
        }

        .template-card .title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .template-card .subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #FC7E15;
            box-shadow: 0 0 0 3px rgba(252, 126, 21, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background-color: #FC7E15;
            color: white;
        }

        .btn-success {
            background-color: #10b981;
            color: white;
            width: 100%;
        }

        .btn-add {
            background-color: #3b82f6;
            color: white;
        }

        .btn-remove {
            background-color: #dc2626;
            color: white;
            padding: 0.5rem;
        }

        .lezione-item {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            padding: 0.75rem;
            background-color: #f9fafb;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .lezione-giorno {
            width: 80px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            padding-top: 0.5rem;
            flex-shrink: 0;
        }

        .lezione-modulo {
            width: 160px;
            flex-shrink: 0;
        }

        .lezione-argomenti {
            flex: 1;
            min-width: 200px;
        }

        .programma-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .programma-container::-webkit-scrollbar {
            width: 8px;
        }

        .programma-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .programma-container::-webkit-scrollbar-thumb {
            background: #FC7E15;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .stat-card.gray {
            background-color: #f9fafb;
        }

        .stat-card.orange {
            background-color: #FC7E15;
            color: white;
        }

        .stat-label {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .stat-card.gray .stat-label {
            color: #6b7280;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .calendario-card {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }

        .calendario-card:hover {
            border-color: #fdba74;
        }

        .calendario-title {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .calendario-date {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.75rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th {
            background-color: #f3f4f6;
            padding: 0.5rem;
            text-align: left;
            border: 1px solid #e5e7eb;
            font-weight: 600;
        }

        td {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        tr:hover {
            background-color: #f9fafb;
        }

        .table-container {
            overflow-x: auto;
        }

        .text-muted {
            color: #6b7280;
            text-align: center;
            padding: 1rem;
            background-color: #f9fafb;
        }

        .icon {
            width: 1.25rem;
            height: 1.25rem;
            color: #FC7E15;
        }

        .icon-lg {
            width: 2rem;
            height: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .result-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #FC7E15;
            margin-bottom: 1rem;
        }

        .info-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .alert-info {
            background-color: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .esclusione-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #fef2f2;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid #dc2626;
        }

        .esclusione-text {
            font-size: 0.875rem;
            color: #374151;
        }

        .esclusione-date {
            font-weight: 600;
            color: #111827;
        }

        .festivity-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: #fef3c7;
            color: #92400e;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .festivity-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .btn-expand {
            background-color: #f3f4f6;
            color: #374151;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            margin-top: 1rem;
            width: 100%;
        }

        .btn-expand:hover {
            background-color: #e5e7eb;
        }

        .exclusion-form {
            display: grid;
            grid-template-columns: auto auto auto 1fr;
            gap: 0.5rem;
            align-items: end;
            margin-bottom: 1rem;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .distribuzione-section {
            background-color: #fff7ed;
            border: 2px solid #FC7E15;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .distribuzione-title {
            font-weight: bold;
            color: #FC7E15;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .opzione-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .opzione-card:hover {
            border-color: #FC7E15;
        }

        .opzione-card.selected {
            border-color: #FC7E15;
            background-color: #fff7ed;
        }

        .opzione-descrizione {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .opzione-dettaglio {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .personalizzata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .ore-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .ore-input-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #6b7280;
        }

        .ore-input {
            text-align: center;
        }

        .ore-calcolo {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
        }

        .totale-ore {
            margin-top: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 600;
            text-align: center;
        }

        .totale-ore.valido {
            background-color: #d1fae5;
            color: #065f46;
        }

        .totale-ore.non-valido {
            background-color: #fee2e2;
            color: #991b1b;
        }

        @media (max-width: 768px) {
            .lezione-item {
                flex-direction: column;
            }
            
            .lezione-giorno,
            .lezione-modulo,
            .lezione-argomenti {
                width: 100%;
            }

            .exclusion-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CalendarioCorsiApp = () => {
            const [templateSelezionato, setTemplateSelezionato] = useState('');
            const [parametri, setParametri] = useState({
                nomeCorso: '',
                oreTotali: 100,
                oreGiorno: 5,
                orarioInizio: '09:00',
                orarioFine: '14:00',
                giorni: [1, 2, 3, 4, 5],
                numeroDocenti: 2,
                dataInizio: '',
                dataFine: '',
            });
            
            const [programma, setProgramma] = useState([]);
            const [risultati, setRisultati] = useState(null);
            const [calendari, setCalendari] = useState([]);
            const [esclusioni, setEsclusioni] = useState([]);
            const [calendariEspansi, setCalendariEspansi] = useState([]);
            const [nomiDocenti, setNomiDocenti] = useState([]);
            const [distribuzioneOre, setDistribuzioneOre] = useState({
                modalita: 'automatica', // 'automatica' o 'personalizzata'
                opzioneScelta: null, // indice opzione automatica scelta
                personalizzata: {
                    ore7: 0,
                    ore6: 0,
                    ore5: 0,
                    ore4: 0,
                    ore3: 0
                }
            });
            const [tipoEsclusione, setTipoEsclusione] = useState('singola'); // 'singola' o 'periodo'
            const [dataEsclusione, setDataEsclusione] = useState('');
            const [dataInizioPeriodo, setDataInizioPeriodo] = useState('');
            const [dataFinePeriodo, setDataFinePeriodo] = useState('');
            const [motivoEsclusione, setMotivoEsclusione] = useState('');

            // Festivit√† italiane 2026
            const festivitaItaliane2026 = [
                { data: '2026-01-01', nome: 'Capodanno' },
                { data: '2026-01-06', nome: 'Epifania' },
                { data: '2026-04-05', nome: 'Pasqua' },
                { data: '2026-04-06', nome: 'Luned√¨ dell\'Angelo' },
                { data: '2026-04-25', nome: 'Festa della Liberazione' },
                { data: '2026-05-01', nome: 'Festa dei Lavoratori' },
                { data: '2026-06-02', nome: 'Festa della Repubblica' },
                { data: '2026-08-15', nome: 'Ferragosto' },
                { data: '2026-11-01', nome: 'Ognissanti' },
                { data: '2026-12-08', nome: 'Immacolata Concezione' },
                { data: '2026-12-25', nome: 'Natale' },
                { data: '2026-12-26', nome: 'Santo Stefano' },
            ];

            const templates = {
                ai100: {
                    nome: 'AI Start - 100 ore',
                    oreTotali: 100,
                    oreGiorno: 5,
                    orarioInizio: '09:00',
                    orarioFine: '14:00',
                    programma: [
                        { giorno: 1, modulo: 'Modulo 1', argomenti: "Cos'√® l'IA (storia, definizioni, ambiti). Tipologie di AI (Narrow, General, Generative)." },
                        { giorno: 2, modulo: 'Modulo 1', argomenti: 'Prompt Engineering (principi base). Panoramica strumenti AI (ChatGPT, Gemini, Copilot).' },
                        { giorno: 3, modulo: 'Modulo 1', argomenti: 'Aggiornamenti Google (Gemini, NotebookLM). Dashboard e personalizzazione account.' },
                        { giorno: 4, modulo: 'Modulo 1', argomenti: 'Deep Research e nuovi motori (Perplexity). Esercitazioni pratiche di base.' },
                        { giorno: 5, modulo: 'Modulo 1', argomenti: 'AI per produttivit√† personale: gestione tempo, to-do list, organizzazione attivit√†.' },
                        { giorno: 6, modulo: 'Moduli 1 e 2', argomenti: 'AI per produttivit√† (continuazione). Creazione CV con AI. Lettere di presentazione.' },
                        { giorno: 7, modulo: 'Modulo 2', argomenti: 'Preparazione colloqui (simulazioni). Strumenti AI per grafica (Canva AI).' },
                        { giorno: 8, modulo: 'Modulo 2', argomenti: 'Contenuti per LinkedIn. Piano base di personal branding. AI nel marketing digitale.' },
                        { giorno: 9, modulo: 'Modulo 2', argomenti: 'Piano editoriale con AI. Generazione contenuti: post e reel per social media.' },
                        { giorno: 10, modulo: 'Modulo 2', argomenti: 'Generazione testi persuasivi. Copywriting con AI per marketing.' },
                        { giorno: 11, modulo: 'Modulo 3', argomenti: 'AI per immagini e video: modelli principali. Canva Magic Design.' },
                        { giorno: 12, modulo: 'Modulo 3', argomenti: 'Esercitazioni pratiche: piani editoriali per Instagram e LinkedIn.' },
                        { giorno: 13, modulo: 'Modulo 3', argomenti: 'Automazioni semplificate: concetti base, vantaggi ed esempi pratici.' },
                        { giorno: 14, modulo: 'Modulo 3', argomenti: 'CRM introduttivo con Excel e Google Sheets. Gestione contatti con AI.' },
                        { giorno: 15, modulo: 'Modulo 3', argomenti: 'Ricerca avanzata con AI su web e LinkedIn. Esercitazioni finali Modulo 3.' },
                        { giorno: 16, modulo: 'Modulo 4', argomenti: 'Avvio project work individuale o di gruppo. Pianificazione attivit√†.' },
                        { giorno: 17, modulo: 'Modulo 4', argomenti: 'Project work: sviluppo e supporto individuale.' },
                        { giorno: 18, modulo: 'Modulo 4', argomenti: 'Presentazione project work (parte 1). Feedback e correzioni.' },
                        { giorno: 19, modulo: 'Modulo 4', argomenti: 'Presentazione project work (parte 2). Personal Branding avanzato su LinkedIn.' },
                        { giorno: 20, modulo: 'Modulo 4', argomenti: 'Come presentare competenze in CV e colloqui. Q&A finale e completamento ore.' },
                    ]
                },
                social50: {
                    nome: 'Social Media Manager con AI - 50 ore',
                    oreTotali: 50,
                    oreGiorno: 4,
                    orarioInizio: '09:00',
                    orarioFine: '13:00',
                    programma: [
                        { giorno: 1, modulo: 'Settimana 1', argomenti: 'Introduzione Marketing e Logiche Digitali' },
                        { giorno: 2, modulo: 'Settimana 1', argomenti: 'Brand, Personal Brand e LinkedIn' },
                        { giorno: 3, modulo: 'Settimana 1', argomenti: 'AI Generativa per Social Media - Parte 1' },
                        { giorno: 4, modulo: 'Settimana 1', argomenti: 'AI per Immagini e Panoramica Ecosistema Social' },
                        { giorno: 5, modulo: 'Settimana 2', argomenti: 'Content Creation Visual con Canva' },
                        { giorno: 6, modulo: 'Settimana 2', argomenti: 'Video Editing Base e Reel con Canva' },
                        { giorno: 7, modulo: 'Settimana 2', argomenti: 'Copywriting e Caption con AI' },
                        { giorno: 8, modulo: 'Settimana 2', argomenti: 'Instagram Marketing Operativo' },
                        { giorno: 9, modulo: 'Settimana 2', argomenti: 'LinkedIn Marketing e B2B' },
                        { giorno: 10, modulo: 'Settimana 3', argomenti: 'Strategia Editoriale e Planning' },
                        { giorno: 11, modulo: 'Settimana 3', argomenti: 'Analytics e Ottimizzazione' },
                        { giorno: 12, modulo: 'Settimana 3', argomenti: 'Facebook, TikTok, YouTube (Panoramica)' },
                        { giorno: 13, modulo: 'Settimana 3', argomenti: 'Project Work Finale e Portfolio' },
                    ]
                }
            };

            const caricaTemplate = (key) => {
                const template = templates[key];
                setTemplateSelezionato(key);
                setParametri({
                    ...parametri,
                    nomeCorso: template.nome,
                    oreTotali: template.oreTotali,
                    oreGiorno: template.oreGiorno,
                    orarioInizio: template.orarioInizio,
                    orarioFine: template.orarioFine,
                });
                setProgramma([...template.programma]);
            };

            // üéØ NUOVA LOGICA: Genera automaticamente le lezioni quando la distribuzione √® definita
            useEffect(() => {
                // Solo per corso personalizzato
                if (templateSelezionato !== 'custom') return;
                
                // Solo se ci sono ore totali e ore giorno valide
                if (parametri.oreTotali === 0 || parametri.oreGiorno === 0) return;

                // ‚ö†Ô∏è VINCOLO: Ore giorno deve essere tra 3 e 7
                if (parametri.oreGiorno < 3 || parametri.oreGiorno > 7) {
                    setProgramma([]);
                    return;
                }

                const opzioni = calcolaOpzioniDistribuzione();
                
                // CASO 1: Distribuzione perfetta (nessun resto)
                if (opzioni.length === 0) {
                    const numGiorni = Math.floor(parametri.oreTotali / parametri.oreGiorno);
                    generaLezioniVuote(numGiorni);
                    return;
                }

                // CASO 2: C'√® resto, ma nessuna distribuzione scelta ancora
                if (distribuzioneOre.modalita === 'automatica' && distribuzioneOre.opzioneScelta === null) {
                    // Non generare ancora le lezioni
                    setProgramma([]);
                    return;
                }

                // CASO 3: Distribuzione automatica scelta
                if (distribuzioneOre.modalita === 'automatica' && distribuzioneOre.opzioneScelta !== null) {
                    const arrayOre = getArrayOreGiornate();
                    // Verifica che tutte le ore rispettino i vincoli
                    const oreNonValide = arrayOre.find(ore => ore < 3 || ore > 7);
                    if (oreNonValide) {
                        setProgramma([]);
                        return;
                    }
                    generaLezioniVuote(arrayOre.length);
                    return;
                }

                // CASO 4: Distribuzione personalizzata
                if (distribuzioneOre.modalita === 'personalizzata') {
                    const totalePersonalizzato = getOrePersonalizzateTotali();
                    // Genera lezioni solo se la distribuzione √® valida
                    if (totalePersonalizzato === parametri.oreTotali && isDistribuzionePersonalizzataValida()) {
                        const arrayOre = getArrayOreGiornate();
                        // Verifica che tutte le ore rispettino i vincoli
                        const oreNonValide = arrayOre.find(ore => ore < 3 || ore > 7);
                        if (oreNonValide) {
                            setProgramma([]);
                            return;
                        }
                        generaLezioniVuote(arrayOre.length);
                    } else {
                        // Distribuzione non valida, non generare lezioni
                        setProgramma([]);
                    }
                }
            }, [templateSelezionato, parametri.oreTotali, parametri.oreGiorno, distribuzioneOre]);

            const generaLezioniVuote = (numLezioni) => {
                // Non rigenerare se il numero √® lo stesso
                if (programma.length === numLezioni) return;
                
                const nuoveProgramma = [];
                for (let i = 0; i < numLezioni; i++) {
                    nuoveProgramma.push({
                        giorno: i + 1,
                        modulo: '',
                        argomenti: ''
                    });
                }
                setProgramma(nuoveProgramma);
            };

            const aggiungiLezione = () => {
                setProgramma([...programma, { giorno: programma.length + 1, modulo: '', argomenti: '' }]);
            };

            const rimuoviLezione = (index) => {
                const nuovoProgramma = programma.filter((_, i) => i !== index);
                nuovoProgramma.forEach((item, i) => item.giorno = i + 1);
                setProgramma(nuovoProgramma);
            };

            const aggiornaLezione = (index, campo, valore) => {
                const nuovoProgramma = [...programma];
                nuovoProgramma[index][campo] = valore;
                setProgramma(nuovoProgramma);
            };

            const aggiungiEsclusione = () => {
                if (tipoEsclusione === 'singola') {
                    if (!dataEsclusione) {
                        alert('Inserisci una data');
                        return;
                    }
                    setEsclusioni([...esclusioni, {
                        tipo: 'singola',
                        data: dataEsclusione,
                        motivo: motivoEsclusione || 'Chiusura',
                        id: Date.now()
                    }]);
                    setDataEsclusione('');
                } else {
                    if (!dataInizioPeriodo || !dataFinePeriodo) {
                        alert('Inserisci entrambe le date del periodo');
                        return;
                    }
                    if (new Date(dataInizioPeriodo) > new Date(dataFinePeriodo)) {
                        alert('La data di inizio deve essere precedente alla data di fine');
                        return;
                    }
                    setEsclusioni([...esclusioni, {
                        tipo: 'periodo',
                        dataInizio: dataInizioPeriodo,
                        dataFine: dataFinePeriodo,
                        motivo: motivoEsclusione || 'Chiusura',
                        id: Date.now()
                    }]);
                    setDataInizioPeriodo('');
                    setDataFinePeriodo('');
                }
                setMotivoEsclusione('');
            };

            const rimuoviEsclusione = (id) => {
                setEsclusioni(esclusioni.filter(e => e.id !== id));
            };

            const isDataEsclusa = (data) => {
                const dataStr = data.toISOString().split('T')[0];
                
                // Controlla festivit√†
                if (festivitaItaliane2026.some(f => f.data === dataStr)) {
                    return true;
                }
                
                // Controlla esclusioni personalizzate
                for (const escl of esclusioni) {
                    if (escl.tipo === 'singola' && escl.data === dataStr) {
                        return true;
                    }
                    if (escl.tipo === 'periodo') {
                        const dataCheck = new Date(dataStr);
                        const inizio = new Date(escl.dataInizio);
                        const fine = new Date(escl.dataFine);
                        if (dataCheck >= inizio && dataCheck <= fine) {
                            return true;
                        }
                    }
                }
                
                return false;
            };

            const calcolaGiorniLavorativi = (dataInizio, dataFine, giorni) => {
                let count = 0;
                let current = new Date(dataInizio);
                const fine = new Date(dataFine);
                
                while (current <= fine) {
                    const dayOfWeek = current.getDay();
                    const dayNum = dayOfWeek === 0 ? 7 : dayOfWeek;
                    
                    if (giorni.includes(dayNum) && !isDataEsclusa(current)) {
                        count++;
                    }
                    current.setDate(current.getDate() + 1);
                }
                return count;
            };

            const getFestivitaNelPeriodo = () => {
                if (!parametri.dataInizio || !parametri.dataFine) return [];
                
                const inizio = new Date(parametri.dataInizio);
                const fine = new Date(parametri.dataFine);
                
                return festivitaItaliane2026.filter(f => {
                    const dataFest = new Date(f.data);
                    return dataFest >= inizio && dataFest <= fine;
                });
            };

            const calcolaCorsi = () => {
                if (!parametri.dataInizio || !parametri.dataFine) {
                    alert('Inserisci le date di inizio e fine periodo');
                    return;
                }

                if (programma.length === 0) {
                    alert('Aggiungi almeno una lezione al programma');
                    return;
                }

                // Validazione ore giorno
                if (parametri.oreGiorno < 3 || parametri.oreGiorno > 7) {
                    alert('‚ö†Ô∏è VINCOLO: Le lezioni devono essere tra 3h e 7h. Correggi "Ore al Giorno".');
                    return;
                }

                // Validazione distribuzione ore personalizzata
                const opzioni = calcolaOpzioniDistribuzione();
                if (opzioni.length > 0 && distribuzioneOre.modalita === 'personalizzata') {
                    const totalePersonalizzato = getOrePersonalizzateTotali();
                    if (totalePersonalizzato !== parametri.oreTotali) {
                        alert(`Attenzione: la distribuzione personalizzata ha ${totalePersonalizzato} ore, ma il corso richiede ${parametri.oreTotali} ore. Correggi la distribuzione.`);
                        return;
                    }
                    
                    // Verifica che non ci siano giorni con ore fuori vincoli (gi√† garantito da interfaccia)
                    if (!isDistribuzionePersonalizzataValida()) {
                        alert('‚ö†Ô∏è VINCOLO: Tutte le lezioni devono essere tra 3h e 7h.');
                        return;
                    }
                }

                // Validazione che l'array ore rispetti i vincoli
                const arrayOre = getArrayOreGiornate();
                const oreNonValide = arrayOre.find(ore => ore < 3 || ore > 7);
                if (oreNonValide) {
                    alert(`‚ö†Ô∏è VINCOLO: Trovata lezione da ${oreNonValide}h. Tutte le lezioni devono essere tra 3h e 7h. Controlla la distribuzione.`);
                    return;
                }

                const giorniNecessari = arrayOre.length;
                const giorniDisponibili = calcolaGiorniLavorativi(parametri.dataInizio, parametri.dataFine, parametri.giorni);
                const corsiPerDocente = Math.floor(giorniDisponibili / giorniNecessari);
                const corsiTotali = corsiPerDocente * parametri.numeroDocenti;

                setRisultati({
                    giorniNecessari,
                    giorniDisponibili,
                    corsiPerDocente,
                    corsiTotali,
                    festivita: getFestivitaNelPeriodo().length,
                    esclusioni: esclusioni.length
                });

                generaCalendari(corsiTotali, giorniNecessari);
            };

            const generaCalendari = (numCorsi, giorniNecessari) => {
                const calendariGenerati = [];
                const arrayOreGiornate = getArrayOreGiornate();
                
                for (let docente = 1; docente <= parametri.numeroDocenti; docente++) {
                    let dataDocenteInizio = new Date(parametri.dataInizio);
                    
                    for (let corso = 1; corso <= Math.floor(numCorsi / parametri.numeroDocenti); corso++) {
                        const lezioni = [];
                        let dataLezione = new Date(dataDocenteInizio);
                        let giorniContati = 0;

                        while (giorniContati < giorniNecessari && giorniContati < programma.length) {
                            const dayOfWeek = dataLezione.getDay();
                            const dayNum = dayOfWeek === 0 ? 7 : dayOfWeek;
                            
                            if (parametri.giorni.includes(dayNum) && !isDataEsclusa(dataLezione)) {
                                const prog = programma[giorniContati];
                                const oreGiornata = arrayOreGiornate[giorniContati] || parametri.oreGiorno;
                                
                                // üïê GESTIONE ORARI con pausa pranzo per giornate da 7h
                                let orario;
                                if (oreGiornata === 7) {
                                    // 7h = 4h mattina + 1h pausa + 3h pomeriggio
                                    // 9:00-13:00 (4h) ‚Üí PAUSA ‚Üí 14:00-17:00 (3h)
                                    orario = "09:00-13:00 / 14:00-17:00";
                                } else {
                                    // Calcola orario fine basato su ore giornata (continuo, senza pausa)
                                    const [oreInizio, minutiInizio] = parametri.orarioInizio.split(':').map(Number);
                                    const minutiTotaliInizio = oreInizio * 60 + minutiInizio;
                                    const minutiTotaliFine = minutiTotaliInizio + (oreGiornata * 60);
                                    const oreFine = Math.floor(minutiTotaliFine / 60);
                                    const minutiFine = minutiTotaliFine % 60;
                                    const orarioFine = `${String(oreFine).padStart(2, '0')}:${String(minutiFine).padStart(2, '0')}`;
                                    orario = `${parametri.orarioInizio} - ${orarioFine}`;
                                }
                                
                                lezioni.push({
                                    data: new Date(dataLezione),
                                    giorno: ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'][dataLezione.getDay()],
                                    orario: orario,
                                    ore: oreGiornata,
                                    modulo: prog.modulo,
                                    argomenti: prog.argomenti,
                                });
                                giorniContati++;
                            }
                            dataLezione.setDate(dataLezione.getDate() + 1);
                        }

                        if (lezioni.length === giorniNecessari) {
                            calendariGenerati.push({
                                nome: `CORSO ${corso}${String.fromCharCode(64 + docente)} - ${getNomeDocente(docente)}`,
                                dataInizio: new Date(lezioni[0].data),
                                dataFine: new Date(lezioni[lezioni.length - 1].data),
                                lezioni,
                            });
                        }

                        dataDocenteInizio = new Date(dataLezione);
                    }
                }

                setCalendari(calendariGenerati);
            };

            const esportaExcel = async () => {
                const workbook = new ExcelJS.Workbook();
                
                calendari.forEach((calendario, idx) => {
                    const worksheet = workbook.addWorksheet(calendario.nome.substring(0, 31));
                    
                    // Titolo (riga 1)
                    worksheet.mergeCells('A1:F1');
                    const titleCell = worksheet.getCell('A1');
                    titleCell.value = calendario.nome;
                    titleCell.font = { bold: true, size: 14, color: { argb: 'FFFFFFFF' } };
                    titleCell.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'FFFC7E15' }
                    };
                    titleCell.alignment = { vertical: 'middle', horizontal: 'left' };
                    worksheet.getRow(1).height = 25;
                    
                    // Sottotitolo (riga 2)
                    worksheet.mergeCells('A2:F2');
                    const subtitleCell = worksheet.getCell('A2');
                    subtitleCell.value = `Periodo: ${calendario.dataInizio.toLocaleDateString('it-IT')} - ${parametri.nomeCorso} (${parametri.oreTotali} Ore)`;
                    subtitleCell.font = { size: 11, color: { argb: 'FF374151' } };
                    subtitleCell.alignment = { vertical: 'middle', horizontal: 'left' };
                    worksheet.getRow(2).height = 20;
                    
                    // Riga vuota (riga 3)
                    worksheet.getRow(3).height = 10;
                    
                    // Header (riga 4)
                    const headerRow = worksheet.getRow(4);
                    const headers = ['Data', 'Giorno', 'Orario', 'Ore', 'Modulo', 'Argomenti'];
                    headers.forEach((header, colIdx) => {
                        const cell = headerRow.getCell(colIdx + 1);
                        cell.value = header;
                        cell.font = { bold: true, size: 11, color: { argb: 'FFFFFFFF' } };
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FFFC7E15' }
                        };
                        cell.alignment = { vertical: 'middle', horizontal: 'center' };
                        cell.border = {
                            top: { style: 'thin', color: { argb: 'FF000000' } },
                            bottom: { style: 'thin', color: { argb: 'FF000000' } },
                            left: { style: 'thin', color: { argb: 'FF000000' } },
                            right: { style: 'thin', color: { argb: 'FF000000' } }
                        };
                    });
                    headerRow.height = 25;
                    
                    // Righe dati (a partire da riga 5)
                    calendario.lezioni.forEach((lezione, lezioneIdx) => {
                        const rowNum = lezioneIdx + 5;
                        const row = worksheet.getRow(rowNum);
                        const isEven = lezioneIdx % 2 === 0;
                        const bgColor = isEven ? 'FFFFFFFF' : 'FFF9FAFB';
                        
                        const rowData = [
                            lezione.data.toLocaleDateString('it-IT'),
                            lezione.giorno,
                            lezione.orario,
                            lezione.ore,
                            lezione.modulo,
                            lezione.argomenti
                        ];
                        
                        rowData.forEach((value, colIdx) => {
                            const cell = row.getCell(colIdx + 1);
                            cell.value = value;
                            cell.fill = {
                                type: 'pattern',
                                pattern: 'solid',
                                fgColor: { argb: bgColor }
                            };
                            cell.alignment = { 
                                vertical: 'top', 
                                horizontal: colIdx === 3 ? 'center' : 'left',
                                wrapText: colIdx === 5
                            };
                            cell.border = {
                                top: { style: 'thin', color: { argb: 'FFE5E7EB' } },
                                bottom: { style: 'thin', color: { argb: 'FFE5E7EB' } },
                                left: { style: 'thin', color: { argb: 'FFE5E7EB' } },
                                right: { style: 'thin', color: { argb: 'FFE5E7EB' } }
                            };
                        });
                        
                        row.height = 30;
                    });
                    
                    // Riga TOTALE (ultima riga)
                    const totaleRowNum = calendario.lezioni.length + 5;
                    const totaleRow = worksheet.getRow(totaleRowNum);
                    
                    ['', '', 'TOTALE ORE:', parametri.oreTotali, '', ''].forEach((value, colIdx) => {
                        const cell = totaleRow.getCell(colIdx + 1);
                        cell.value = value;
                        cell.font = { bold: true, size: 11 };
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FFF3F4F6' }
                        };
                        cell.alignment = { vertical: 'middle', horizontal: colIdx === 2 ? 'right' : (colIdx === 3 ? 'center' : 'left') };
                        cell.border = {
                            top: { style: 'thin', color: { argb: 'FF000000' } },
                            bottom: { style: 'thin', color: { argb: 'FF000000' } },
                            left: { style: 'thin', color: { argb: 'FF000000' } },
                            right: { style: 'thin', color: { argb: 'FF000000' } }
                        };
                    });
                    totaleRow.height = 25;
                    
                    // Dimensioni colonne
                    worksheet.getColumn(1).width = 12;
                    worksheet.getColumn(2).width = 12;
                    worksheet.getColumn(3).width = 15;
                    worksheet.getColumn(4).width = 8;
                    worksheet.getColumn(5).width = 20;
                    worksheet.getColumn(6).width = 60;
                });
                
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const filename = `Calendari_${parametri.nomeCorso.replace(/\s+/g, '_')}_2026.xlsx`;
                saveAs(blob, filename);
            };

            const toggleEspansioneCalendario = (indice) => {
                if (calendariEspansi.includes(indice)) {
                    setCalendariEspansi(calendariEspansi.filter(i => i !== indice));
                } else {
                    setCalendariEspansi([...calendariEspansi, indice]);
                }
            };

            const aggiornaNumeroDocenti = (numero) => {
                setParametri({ ...parametri, numeroDocenti: numero });
                const nuoviNomi = [...nomiDocenti];
                while (nuoviNomi.length < numero) {
                    nuoviNomi.push('');
                }
                setNomiDocenti(nuoviNomi.slice(0, numero));
            };

            const aggiornaNomeDocente = (index, nome) => {
                const nuoviNomi = [...nomiDocenti];
                nuoviNomi[index] = nome;
                setNomiDocenti(nuoviNomi);
            };

            const getNomeDocente = (index) => {
                return nomiDocenti[index - 1] || `Docente ${index}`;
            };

            // Calcola opzioni automatiche per distribuzione ore
            // VINCOLI: MIN 3h, MAX 7h per ogni lezione
            const calcolaOpzioniDistribuzione = () => {
                const totale = parametri.oreTotali;
                const giornata = parametri.oreGiorno;
                
                if (totale === 0 || giornata === 0) return [];
                
                // Verifica che ore giorno rispetti i vincoli
                if (giornata < 3 || giornata > 7) {
                    return []; // Ore giorno non valide
                }
                
                const giorniCompleti = Math.floor(totale / giornata);
                const resto = totale % giornata;
                
                if (resto === 0) {
                    return []; // Distribuzione perfetta, nessuna opzione da mostrare
                }
                
                // ‚ö†Ô∏è VINCOLO: resto < 3h NON √® valido, devo redistribuire
                const opzioni = [];
                
                // Strategia 1: Se resto < 3h, riduco i giorni completi e redistribuisco
                if (resto < 3) {
                    // Es: 50h √∑ 7h = 7 giorni + 1h ‚Üí riduco a 6 giorni da 7h + (1h+7h=8h) da redistribuire
                    const oreRimanenti = resto + giornata;
                    const giorniCompletiFix = giorniCompleti - 1;
                    
                    // Opzione A: 2 giorni da 4h (se possibile)
                    if (oreRimanenti === 8) {
                        opzioni.push({
                            descrizione: `${giorniCompletiFix} giorni da ${giornata}h + 2 giorni da 4h`,
                            dettaglio: `${giorniCompletiFix}√ó${giornata}h + 2√ó4h = ${totale}h`,
                            distribuzione: {
                                [giornata]: giorniCompletiFix,
                                4: 2
                            }
                        });
                    }
                    
                    // Opzione B: Combinazioni con 3h, 4h, 5h, 6h
                    for (let ore1 = 7; ore1 >= 3; ore1--) {
                        for (let ore2 = 7; ore2 >= 3; ore2--) {
                            if (ore1 + ore2 === oreRimanenti && ore1 >= ore2) {
                                const desc = ore1 === ore2 
                                    ? `${giorniCompletiFix} giorni da ${giornata}h + 2 giorni da ${ore1}h`
                                    : `${giorniCompletiFix} giorni da ${giornata}h + 1 giorno da ${ore1}h + 1 giorno da ${ore2}h`;
                                const det = ore1 === ore2
                                    ? `${giorniCompletiFix}√ó${giornata}h + 2√ó${ore1}h = ${totale}h`
                                    : `${giorniCompletiFix}√ó${giornata}h + 1√ó${ore1}h + 1√ó${ore2}h = ${totale}h`;
                                
                                const distribuzione = { [giornata]: giorniCompletiFix };
                                if (ore1 === ore2) {
                                    distribuzione[ore1] = 2;
                                } else {
                                    distribuzione[ore1] = 1;
                                    distribuzione[ore2] = 1;
                                }
                                
                                // Evita duplicati
                                if (!opzioni.some(o => o.descrizione === desc)) {
                                    opzioni.push({ descrizione: desc, dettaglio: det, distribuzione });
                                }
                                
                                if (opzioni.length >= 3) break;
                            }
                        }
                        if (opzioni.length >= 3) break;
                    }
                    
                    // Opzione C: Distribuire su pi√π giorni da 3h
                    const giorniDa3 = Math.ceil(oreRimanenti / 3);
                    if (giorniDa3 >= 2 && giorniDa3 * 3 <= oreRimanenti + 2) {
                        const oreUltimo = oreRimanenti - ((giorniDa3 - 1) * 3);
                        if (oreUltimo >= 3 && oreUltimo <= 7) {
                            opzioni.push({
                                descrizione: `${giorniCompletiFix} giorni da ${giornata}h + ${giorniDa3} giorni da 3h`,
                                dettaglio: `${giorniCompletiFix}√ó${giornata}h + ${giorniDa3}√ó3h = ${totale}h`,
                                distribuzione: {
                                    [giornata]: giorniCompletiFix,
                                    3: giorniDa3
                                }
                            });
                        }
                    }
                    
                } else {
                    // Resto >= 3h, possiamo lavorare con questo
                    
                    // Opzione 1: Distribuire resto su giornate da 4h (se resto >= 4)
                    if (resto >= 4) {
                        const giorniResto4 = Math.floor(resto / 4);
                        const restoFinale = resto % 4;
                        
                        if (restoFinale === 0) {
                            // Perfetto, solo giorni da 4h
                            opzioni.push({
                                descrizione: `${giorniCompleti} giorni da ${giornata}h + ${giorniResto4} giorni da 4h`,
                                dettaglio: `${giorniCompleti}√ó${giornata}h + ${giorniResto4}√ó4h = ${totale}h`,
                                distribuzione: {
                                    [giornata]: giorniCompleti,
                                    4: giorniResto4
                                }
                            });
                        } else if (restoFinale >= 3) {
                            // giorniResto4 giorni da 4h + 1 giorno da restoFinale
                            opzioni.push({
                                descrizione: `${giorniCompleti} giorni da ${giornata}h + ${giorniResto4} giorni da 4h + 1 giorno da ${restoFinale}h`,
                                dettaglio: `${giorniCompleti}√ó${giornata}h + ${giorniResto4}√ó4h + 1√ó${restoFinale}h = ${totale}h`,
                                distribuzione: {
                                    [giornata]: giorniCompleti,
                                    4: giorniResto4,
                                    [restoFinale]: 1
                                }
                            });
                        }
                    }
                    
                    // Opzione 2: Distribuire resto su giornate da 3h
                    const giorniResto3 = Math.ceil(resto / 3);
                    opzioni.push({
                        descrizione: `${giorniCompleti} giorni da ${giornata}h + ${giorniResto3} giorni da 3h`,
                        dettaglio: `${giorniCompleti}√ó${giornata}h + ${giorniResto3}√ó3h = ${totale}h`,
                        distribuzione: {
                            [giornata]: giorniCompleti,
                            3: giorniResto3
                        }
                    });
                    
                    // Opzione 3: Redistribuire riducendo ore giornata
                    if (giornata >= 5) {
                        const giorniMeno = Math.floor(resto / 2);
                        const nuoviCompleti = giorniCompleti - giorniMeno;
                        const nuoveOre = giornata - 2;
                        if (nuoviCompleti > 0 && nuoveOre >= 3) {
                            const giorniNuoveOre = giorniMeno * 2;
                            if (nuoviCompleti * giornata + giorniNuoveOre * nuoveOre === totale) {
                                opzioni.push({
                                    descrizione: `${nuoviCompleti} giorni da ${giornata}h + ${giorniNuoveOre} giorni da ${nuoveOre}h`,
                                    dettaglio: `${nuoviCompleti}√ó${giornata}h + ${giorniNuoveOre}√ó${nuoveOre}h = ${totale}h`,
                                    distribuzione: {
                                        [giornata]: nuoviCompleti,
                                        [nuoveOre]: giorniNuoveOre
                                    }
                                });
                            }
                        }
                    }
                }
                
                return opzioni.slice(0, 3); // Max 3 opzioni
            };

            const getOrePersonalizzateTotali = () => {
                const p = distribuzioneOre.personalizzata;
                return (p.ore7 * 7) + (p.ore6 * 6) + (p.ore5 * 5) + (p.ore4 * 4) + (p.ore3 * 3);
            };

            const aggiornaDistribuzionePersonalizzata = (ore, valore) => {
                setDistribuzioneOre({
                    ...distribuzioneOre,
                    personalizzata: {
                        ...distribuzioneOre.personalizzata,
                        [ore]: parseInt(valore) || 0
                    }
                });
            };

            // Valida che la distribuzione personalizzata rispetti i vincoli 3-7h
            const isDistribuzionePersonalizzataValida = () => {
                const p = distribuzioneOre.personalizzata;
                const totalePersonalizzato = getOrePersonalizzateTotali();
                
                // Deve essere uguale al totale corso
                if (totalePersonalizzato !== parametri.oreTotali) {
                    return false;
                }
                
                // Tutti i valori devono essere >= 0
                if (p.ore7 < 0 || p.ore6 < 0 || p.ore5 < 0 || p.ore4 < 0 || p.ore3 < 0) {
                    return false;
                }
                
                return true;
            };

            // Ottiene array di ore per ogni giornata basato sulla distribuzione scelta
            const getArrayOreGiornate = () => {
                const opzioni = calcolaOpzioniDistribuzione();
                
                // Se distribuzione perfetta, usa ore standard
                if (opzioni.length === 0) {
                    const numGiorni = Math.floor(parametri.oreTotali / parametri.oreGiorno);
                    return Array(numGiorni).fill(parametri.oreGiorno);
                }
                
                let distribuzione = {};
                
                if (distribuzioneOre.modalita === 'automatica' && distribuzioneOre.opzioneScelta !== null) {
                    // Usa opzione automatica scelta
                    distribuzione = opzioni[distribuzioneOre.opzioneScelta].distribuzione;
                } else if (distribuzioneOre.modalita === 'personalizzata') {
                    // Usa distribuzione personalizzata
                    const p = distribuzioneOre.personalizzata;
                    if (p.ore7 > 0) distribuzione[7] = p.ore7;
                    if (p.ore6 > 0) distribuzione[6] = p.ore6;
                    if (p.ore5 > 0) distribuzione[5] = p.ore5;
                    if (p.ore4 > 0) distribuzione[4] = p.ore4;
                    if (p.ore3 > 0) distribuzione[3] = p.ore3;
                } else {
                    // Nessuna opzione selezionata, usa prima opzione automatica
                    distribuzione = opzioni[0].distribuzione;
                }
                
                // Crea array con ordine: prima 7h, poi 6h, 5h, 4h, 3h
                const arrayOre = [];
                [7, 6, 5, 4, 3].forEach(ore => {
                    if (distribuzione[ore]) {
                        for (let i = 0; i < distribuzione[ore]; i++) {
                            arrayOre.push(ore);
                        }
                    }
                });
                
                return arrayOre;
            };

            return (
                <div>
                    <div className="header">
                        <div className="container">
                            <h1>
                                <svg className="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Generatore Calendari Corsi 2026
                            </h1>
                            <p>SONODIGITALE - Tool per Arianna @ Atoma srl</p>
                        </div>
                    </div>

                    <div className="container">
                        {/* Template */}
                        <div className="section">
                            <div className="section-title">
                                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                1. Scegli Template Corso
                            </div>
                            <div className="grid grid-cols-3">
                                <button
                                    onClick={() => caricaTemplate('ai100')}
                                    className={`template-card ${templateSelezionato === 'ai100' ? 'active' : ''}`}
                                >
                                    <div className="title">AI Start - 100 ore</div>
                                    <div className="subtitle">4 settimane, 5h/giorno, 20 lezioni</div>
                                </button>
                                <button
                                    onClick={() => caricaTemplate('social50')}
                                    className={`template-card ${templateSelezionato === 'social50' ? 'active' : ''}`}
                                >
                                    <div className="title">Social Media Manager - 50 ore</div>
                                    <div className="subtitle">3 settimane, 4h/giorno, 13 lezioni</div>
                                </button>
                                <button
                                    onClick={() => {
                                        setTemplateSelezionato('custom');
                                        setProgramma([]); // üéØ NON creare lezioni subito
                                        setParametri({
                                            ...parametri,
                                            nomeCorso: '',
                                            oreTotali: 0,
                                            oreGiorno: 0
                                        });
                                        // Reset distribuzione
                                        setDistribuzioneOre({
                                            modalita: 'automatica',
                                            opzioneScelta: null,
                                            personalizzata: {
                                                ore7: 0,
                                                ore6: 0,
                                                ore5: 0,
                                                ore4: 0,
                                                ore3: 0
                                            }
                                        });
                                    }}
                                    className={`template-card ${templateSelezionato === 'custom' ? 'active' : ''}`}
                                >
                                    <div className="title">Corso Personalizzato</div>
                                    <div className="subtitle">Crea da zero</div>
                                </button>
                            </div>
                        </div>

                        {/* Parametri */}
                        <div className="section">
                            <div className="section-title">
                                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                2. Parametri Corso
                            </div>
                            <div className="grid grid-cols-4">
                                <div className="form-group">
                                    <label className="form-label">Nome Corso</label>
                                    <input
                                        type="text"
                                        value={parametri.nomeCorso}
                                        onChange={(e) => setParametri({ ...parametri, nomeCorso: e.target.value })}
                                        className="form-input"
                                        placeholder="Es: AI Start"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Ore Totali</label>
                                    <input
                                        type="number"
                                        value={parametri.oreTotali}
                                        onChange={(e) => setParametri({ ...parametri, oreTotali: parseInt(e.target.value) || 0 })}
                                        className="form-input"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Ore al Giorno</label>
                                    <input
                                        type="number"
                                        value={parametri.oreGiorno}
                                        onChange={(e) => setParametri({ ...parametri, oreGiorno: parseInt(e.target.value) || 0 })}
                                        className="form-input"
                                        min="3"
                                        max="7"
                                    />
                                    {(parametri.oreGiorno < 3 || parametri.oreGiorno > 7) && parametri.oreGiorno !== 0 && (
                                        <div style={{fontSize: '0.75rem', color: '#dc2626', marginTop: '0.25rem'}}>
                                            ‚ö†Ô∏è Le lezioni devono essere tra 3h e 7h
                                        </div>
                                    )}
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Numero Docenti</label>
                                    <input
                                        type="number"
                                        value={parametri.numeroDocenti}
                                        onChange={(e) => aggiornaNumeroDocenti(parseInt(e.target.value) || 1)}
                                        className="form-input"
                                        min="1"
                                        max="10"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Orario Inizio</label>
                                    <input
                                        type="time"
                                        value={parametri.orarioInizio}
                                        onChange={(e) => setParametri({ ...parametri, orarioInizio: e.target.value })}
                                        className="form-input"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Orario Fine</label>
                                    <input
                                        type="time"
                                        value={parametri.orarioFine}
                                        onChange={(e) => setParametri({ ...parametri, orarioFine: e.target.value })}
                                        className="form-input"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Data Inizio Periodo</label>
                                    <input
                                        type="date"
                                        value={parametri.dataInizio}
                                        onChange={(e) => setParametri({ ...parametri, dataInizio: e.target.value })}
                                        className="form-input"
                                        min="2026-01-01"
                                        max="2026-12-31"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Data Fine Periodo</label>
                                    <input
                                        type="date"
                                        value={parametri.dataFine}
                                        onChange={(e) => setParametri({ ...parametri, dataFine: e.target.value })}
                                        className="form-input"
                                        min="2026-01-01"
                                        max="2026-12-31"
                                    />
                                </div>
                            </div>

                            {/* Box Festivit√† nel Periodo */}
                            {parametri.dataInizio && parametri.dataFine && (() => {
                                const festivitaNelPeriodo = getFestivitaNelPeriodo();
                                if (festivitaNelPeriodo.length > 0) {
                                    return (
                                        <div style={{marginTop: '1.5rem', paddingTop: '1.5rem', borderTop: '1px solid #e5e7eb'}}>
                                            <div style={{
                                                backgroundColor: '#dbeafe',
                                                border: '2px solid #3b82f6',
                                                borderRadius: '0.5rem',
                                                padding: '1rem'
                                            }}>
                                                <div style={{
                                                    fontWeight: 'bold',
                                                    color: '#1e40af',
                                                    marginBottom: '0.5rem',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '0.5rem'
                                                }}>
                                                    üéâ Festivit√† nel periodo selezionato ({festivitaNelPeriodo.length}):
                                                </div>
                                                <div style={{
                                                    display: 'flex',
                                                    flexWrap: 'wrap',
                                                    gap: '0.5rem',
                                                    marginTop: '0.5rem'
                                                }}>
                                                    {festivitaNelPeriodo.map((festa, idx) => (
                                                        <div key={idx} style={{
                                                            backgroundColor: '#fef3c7',
                                                            color: '#92400e',
                                                            padding: '0.25rem 0.75rem',
                                                            borderRadius: '0.25rem',
                                                            fontSize: '0.875rem',
                                                            fontWeight: '500'
                                                        }}>
                                                            {new Date(festa.data).toLocaleDateString('it-IT')} - {festa.nome}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                }
                                return null;
                            })()}

                            {/* Nomi Docenti */}
                            {parametri.numeroDocenti > 0 && (
                                <div style={{marginTop: '1.5rem', paddingTop: '1.5rem', borderTop: '1px solid #e5e7eb'}}>
                                    <label className="form-label" style={{marginBottom: '0.75rem', display: 'block', fontSize: '1rem', fontWeight: '600'}}>
                                        üìù Nomi Docenti (opzionale)
                                    </label>
                                    <div style={{fontSize: '0.875rem', color: '#6b7280', marginBottom: '0.75rem'}}>
                                        Lascia vuoto per usare "Docente 1", "Docente 2", ecc. Puoi inserire solo alcuni nomi.
                                    </div>
                                    <div className="grid grid-cols-4">
                                        {Array.from({ length: parametri.numeroDocenti }, (_, i) => (
                                            <div key={i} className="form-group">
                                                <label className="form-label">Docente {i + 1}</label>
                                                <input
                                                    type="text"
                                                    value={nomiDocenti[i] || ''}
                                                    onChange={(e) => aggiornaNomeDocente(i, e.target.value)}
                                                    className="form-input"
                                                    placeholder={`Docente ${i + 1}`}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Giorni della settimana */}
                            <div style={{marginTop: '1.5rem', paddingTop: '1.5rem', borderTop: '1px solid #e5e7eb'}}>
                                <label className="form-label" style={{marginBottom: '0.75rem', display: 'block', fontSize: '1rem', fontWeight: '600'}}>
                                    üìÖ Giorni Lavorativi
                                </label>
                                <div style={{display: 'flex', gap: '0.75rem', flexWrap: 'wrap'}}>
                                    {[
                                        { num: 1, nome: 'Luned√¨' },
                                        { num: 2, nome: 'Marted√¨' },
                                        { num: 3, nome: 'Mercoled√¨' },
                                        { num: 4, nome: 'Gioved√¨' },
                                        { num: 5, nome: 'Venerd√¨' },
                                        { num: 6, nome: 'Sabato' },
                                        { num: 7, nome: 'Domenica' },
                                    ].map(giorno => (
                                        <label key={giorno.num} className="radio-label" style={{
                                            padding: '0.5rem 1rem',
                                            borderRadius: '0.375rem',
                                            border: '2px solid',
                                            borderColor: parametri.giorni.includes(giorno.num) ? '#FC7E15' : '#e5e7eb',
                                            backgroundColor: parametri.giorni.includes(giorno.num) ? '#fff7ed' : 'white',
                                            cursor: 'pointer',
                                            transition: 'all 0.2s'
                                        }}>
                                            <input
                                                type="checkbox"
                                                checked={parametri.giorni.includes(giorno.num)}
                                                onChange={(e) => {
                                                    if (e.target.checked) {
                                                        setParametri({ ...parametri, giorni: [...parametri.giorni, giorno.num].sort() });
                                                    } else {
                                                        setParametri({ ...parametri, giorni: parametri.giorni.filter(d => d !== giorno.num) });
                                                    }
                                                }}
                                            />
                                            {giorno.nome}
                                        </label>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Distribuzione Ore (solo se necessario) */}
                        {(() => {
                            const opzioni = calcolaOpzioniDistribuzione();
                            const totalePersonalizzato = getOrePersonalizzateTotali();
                            const isValido = totalePersonalizzato === parametri.oreTotali;
                            
                            if (opzioni.length > 0 && templateSelezionato === 'custom') {
                                return (
                                    <div className="section">
                                        <div className="section-title">
                                            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            3. Distribuzione Ore
                                        </div>

                                        <div className="alert alert-warning">
                                            <strong>‚ö†Ô∏è Attenzione:</strong> {parametri.oreTotali}h √∑ {parametri.oreGiorno}h al giorno = {Math.floor(parametri.oreTotali / parametri.oreGiorno)} giorni completi + {parametri.oreTotali % parametri.oreGiorno}h di resto.<br />
                                            <strong>Scegli come distribuire il resto:</strong><br />
                                            <small>‚ö†Ô∏è <strong>VINCOLI:</strong> Ogni lezione deve essere minimo 3h e massimo 7h. Lezioni da 7h = 9:00-13:00 / 14:00-17:00 (con pausa pranzo).</small>
                                        </div>

                                        <div className="distribuzione-section">
                                            <div className="distribuzione-title">üìä Opzioni Distribuzione</div>
                                            
                                            {/* Opzioni Automatiche */}
                                            {opzioni.map((opzione, idx) => (
                                                <div
                                                    key={idx}
                                                    className={`opzione-card ${distribuzioneOre.modalita === 'automatica' && distribuzioneOre.opzioneScelta === idx ? 'selected' : ''}`}
                                                    onClick={() => setDistribuzioneOre({ modalita: 'automatica', opzioneScelta: idx, personalizzata: distribuzioneOre.personalizzata })}
                                                >
                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                        <input
                                                            type="radio"
                                                            checked={distribuzioneOre.modalita === 'automatica' && distribuzioneOre.opzioneScelta === idx}
                                                            onChange={() => {}}
                                                        />
                                                        <div style={{flex: 1}}>
                                                            <div className="opzione-descrizione">Opzione {String.fromCharCode(65 + idx)}: {opzione.descrizione}</div>
                                                            <div className="opzione-dettaglio">{opzione.dettaglio}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}

                                            {/* Opzione Personalizzata */}
                                            <div
                                                className={`opzione-card ${distribuzioneOre.modalita === 'personalizzata' ? 'selected' : ''}`}
                                                onClick={() => setDistribuzioneOre({ ...distribuzioneOre, modalita: 'personalizzata' })}
                                            >
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem'}}>
                                                    <input
                                                        type="radio"
                                                        checked={distribuzioneOre.modalita === 'personalizzata'}
                                                        onChange={() => {}}
                                                    />
                                                    <div className="opzione-descrizione">Personalizzata (tu decidi)</div>
                                                </div>

                                                {distribuzioneOre.modalita === 'personalizzata' && (
                                                    <div style={{marginTop: '0.75rem', paddingLeft: '1.5rem'}}>
                                                        <div style={{fontSize: '0.875rem', color: '#6b7280', marginBottom: '0.5rem'}}>
                                                            ‚ÑπÔ∏è Inserisci il numero di giorni per ogni fascia oraria (solo 3h-7h permessi).
                                                        </div>
                                                        <div className="personalizzata-grid">
                                                            {[7, 6, 5, 4, 3].map(ore => (
                                                                <div key={ore} className="ore-input-group">
                                                                    <label className="ore-input-label">Giorni da {ore}h</label>
                                                                    <input
                                                                        type="number"
                                                                        min="0"
                                                                        value={distribuzioneOre.personalizzata[`ore${ore}`]}
                                                                        onChange={(e) => aggiornaDistribuzionePersonalizzata(`ore${ore}`, e.target.value)}
                                                                        className="form-input ore-input"
                                                                        onClick={(e) => e.stopPropagation()}
                                                                    />
                                                                    <div className="ore-calcolo">
                                                                        = {distribuzioneOre.personalizzata[`ore${ore}`] * ore}h
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>

                                                        <div className={`totale-ore ${isValido ? 'valido' : 'non-valido'}`}>
                                                            Totale: {totalePersonalizzato}h / {parametri.oreTotali}h {isValido ? '‚úÖ Perfetto!' : `‚ùå ${totalePersonalizzato > parametri.oreTotali ? 'Troppe' : 'Mancano'} ${Math.abs(totalePersonalizzato - parametri.oreTotali)} ore`}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            }
                            return null;
                        })()}

                        {/* Esclusioni Personalizzate */}
                        <div className="section">
                            <div className="section-title">
                                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                                </svg>
                                {calcolaOpzioniDistribuzione().length > 0 && templateSelezionato === 'custom' ? '4' : '3'}. Esclusioni Personalizzate (Chiusure Atoma)
                            </div>

                            <div className="alert alert-warning">
                                <strong>‚ÑπÔ∏è Le festivit√† nazionali italiane sono gi√† escluse automaticamente.</strong><br />
                                Usa questa sezione per aggiungere chiusure aziendali extra (es: settimana di Pasqua estesa, chiusura estiva, ecc.)
                            </div>

                            <div className="radio-group">
                                <label className="radio-label">
                                    <input
                                        type="radio"
                                        checked={tipoEsclusione === 'singola'}
                                        onChange={() => setTipoEsclusione('singola')}
                                    />
                                    Giorno Singolo
                                </label>
                                <label className="radio-label">
                                    <input
                                        type="radio"
                                        checked={tipoEsclusione === 'periodo'}
                                        onChange={() => setTipoEsclusione('periodo')}
                                    />
                                    Periodo (Range)
                                </label>
                            </div>

                            <div className="exclusion-form">
                                {tipoEsclusione === 'singola' ? (
                                    <div className="form-group">
                                        <label className="form-label">Data</label>
                                        <input
                                            type="date"
                                            value={dataEsclusione}
                                            onChange={(e) => setDataEsclusione(e.target.value)}
                                            className="form-input"
                                            min="2026-01-01"
                                            max="2026-12-31"
                                        />
                                    </div>
                                ) : (
                                    <>
                                        <div className="form-group">
                                            <label className="form-label">Da</label>
                                            <input
                                                type="date"
                                                value={dataInizioPeriodo}
                                                onChange={(e) => setDataInizioPeriodo(e.target.value)}
                                                className="form-input"
                                                min="2026-01-01"
                                                max="2026-12-31"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">A</label>
                                            <input
                                                type="date"
                                                value={dataFinePeriodo}
                                                onChange={(e) => setDataFinePeriodo(e.target.value)}
                                                className="form-input"
                                                min="2026-01-01"
                                                max="2026-12-31"
                                            />
                                        </div>
                                    </>
                                )}
                                
                                <div className="form-group">
                                    <label className="form-label">Motivo (opzionale)</label>
                                    <input
                                        type="text"
                                        value={motivoEsclusione}
                                        onChange={(e) => setMotivoEsclusione(e.target.value)}
                                        className="form-input"
                                        placeholder="Es: Chiusura Pasqua"
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">&nbsp;</label>
                                    <button onClick={aggiungiEsclusione} className="btn btn-add">
                                        <svg style={{width: '16px', height: '16px'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                        </svg>
                                        Aggiungi
                                    </button>
                                </div>
                            </div>

                            {esclusioni.length > 0 && (
                                <div style={{marginTop: '1rem'}}>
                                    <strong>Esclusioni aggiunte ({esclusioni.length}):</strong>
                                    <div style={{marginTop: '0.5rem'}}>
                                        {esclusioni.map(escl => (
                                            <div key={escl.id} className="esclusione-item">
                                                <div>
                                                    {escl.tipo === 'singola' ? (
                                                        <div className="esclusione-text">
                                                            <span className="esclusione-date">{new Date(escl.data).toLocaleDateString('it-IT')}</span>
                                                            {escl.motivo && ` - ${escl.motivo}`}
                                                        </div>
                                                    ) : (
                                                        <div className="esclusione-text">
                                                            <span className="esclusione-date">
                                                                {new Date(escl.dataInizio).toLocaleDateString('it-IT')} ‚Üí {new Date(escl.dataFine).toLocaleDateString('it-IT')}
                                                            </span>
                                                            {escl.motivo && ` - ${escl.motivo}`}
                                                        </div>
                                                    )}
                                                </div>
                                                <button onClick={() => rimuoviEsclusione(escl.id)} className="btn btn-remove">
                                                    <svg style={{width: '16px', height: '16px'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                    </svg>
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Programma - üéØ MOSTRATO SOLO SE CI SONO LEZIONI */}
                        {programma.length > 0 && (
                            <div className="section">
                                <div className="section-header">
                                    <div className="section-title">
                                        <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        {calcolaOpzioniDistribuzione().length > 0 && templateSelezionato === 'custom' ? '5' : '4'}. Programma Didattico ({programma.length} lezioni)
                                    </div>
                                    <button onClick={aggiungiLezione} className="btn btn-add">
                                        <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                        </svg>
                                        Aggiungi Lezione
                                    </button>
                                </div>

                                {templateSelezionato === 'custom' && (
                                    <div className="alert alert-success" style={{marginBottom: '1rem'}}>
                                        <strong>‚úÖ Lezioni generate automaticamente!</strong><br />
                                        Il programma √® stato creato con {programma.length} lezioni in base alla distribuzione ore scelta. Compila i moduli e gli argomenti per ogni lezione.
                                    </div>
                                )}

                                <div className="programma-container">
                                    {programma.map((lezione, index) => (
                                        <div key={index} className="lezione-item">
                                            <div className="lezione-giorno">Giorno {lezione.giorno}</div>
                                            <input
                                                type="text"
                                                value={lezione.modulo}
                                                onChange={(e) => aggiornaLezione(index, 'modulo', e.target.value)}
                                                className="form-input lezione-modulo"
                                                placeholder="Modulo"
                                            />
                                            <input
                                                type="text"
                                                value={lezione.argomenti}
                                                onChange={(e) => aggiornaLezione(index, 'argomenti', e.target.value)}
                                                className="form-input lezione-argomenti"
                                                placeholder="Argomenti della lezione"
                                            />
                                            <button onClick={() => rimuoviLezione(index)} className="btn btn-remove">
                                                <svg style={{width: '16px', height: '16px'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Calcola */}
                        <div className="section">
                            <button onClick={calcolaCorsi} className="btn btn-primary">
                                <svg style={{width: '24px', height: '24px'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                Calcola Corsi e Genera Calendari
                            </button>
                        </div>

                        {/* Risultati */}
                        {risultati && (
                            <div className="section">
                                <div className="result-title">üìä Risultati Calcolo</div>
                                
                                <div className="alert alert-info" style={{marginBottom: '1rem'}}>
                                    <strong>üìÖ Giorni esclusi dal calcolo:</strong><br />
                                    ‚Ä¢ Festivit√† nazionali: {risultati.festivita}<br />
                                    ‚Ä¢ Esclusioni personalizzate: {risultati.esclusioni}<br />
                                    ‚Ä¢ Weekend e giorni non lavorativi
                                </div>

                                <div className="stats-grid">
                                    <div className="stat-card gray">
                                        <div className="stat-label">Giorni Necessari</div>
                                        <div className="stat-value">{risultati.giorniNecessari}</div>
                                    </div>
                                    <div className="stat-card gray">
                                        <div className="stat-label">Giorni Disponibili</div>
                                        <div className="stat-value">{risultati.giorniDisponibili}</div>
                                    </div>
                                    <div className="stat-card gray">
                                        <div className="stat-label">Corsi per Docente</div>
                                        <div className="stat-value">{risultati.corsiPerDocente}</div>
                                    </div>
                                    <div className="stat-card orange">
                                        <div className="stat-label">Corsi Totali</div>
                                        <div className="stat-value">{risultati.corsiTotali}</div>
                                    </div>
                                </div>

                                {calendari.length > 0 && (
                                    <>
                                        <button onClick={esportaExcel} className="btn btn-success">
                                            <svg style={{width: '20px', height: '20px'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                            </svg>
                                            Scarica Tutti i Calendari Excel
                                        </button>

                                        <div className="info-text">
                                            Generati {calendari.length} calendari completi
                                        </div>

                                        <div>
                                            {calendari.map((calendario, idx) => {
                                                const isEspanso = calendariEspansi.includes(idx);
                                                const lezioniDaMostrare = isEspanso ? calendario.lezioni : calendario.lezioni.slice(0, 5);
                                                
                                                return (
                                                    <div key={idx} className="calendario-card">
                                                        <div className="calendario-title">{calendario.nome}</div>
                                                        <div className="calendario-date">
                                                            üìÖ {calendario.dataInizio.toLocaleDateString('it-IT')} ‚Üí {calendario.dataFine.toLocaleDateString('it-IT')} ({calendario.lezioni.length} lezioni)
                                                        </div>
                                                        <div className="table-container">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th>Data</th>
                                                                        <th>Giorno</th>
                                                                        <th>Orario</th>
                                                                        <th>Ore</th>
                                                                        <th>Modulo</th>
                                                                        <th>Argomenti</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {lezioniDaMostrare.map((lezione, lidx) => (
                                                                        <tr key={lidx}>
                                                                            <td>{lezione.data.toLocaleDateString('it-IT')}</td>
                                                                            <td>{lezione.giorno}</td>
                                                                            <td>{lezione.orario}</td>
                                                                            <td style={{textAlign: 'center'}}>{lezione.ore}h</td>
                                                                            <td>{lezione.modulo}</td>
                                                                            <td style={{fontSize: '0.75rem'}}>
                                                                                {isEspanso ? lezione.argomenti : (
                                                                                    <>
                                                                                        {lezione.argomenti.substring(0, 80)}{lezione.argomenti.length > 80 ? '...' : ''}
                                                                                    </>
                                                                                )}
                                                                            </td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        {calendario.lezioni.length > 5 && (
                                                            <button 
                                                                onClick={() => toggleEspansioneCalendario(idx)} 
                                                                className="btn btn-expand"
                                                            >
                                                                {isEspanso ? (
                                                                    <>
                                                                        <svg style={{width: '16px', height: '16px', display: 'inline-block', marginRight: '0.5rem'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                                                                        </svg>
                                                                        Mostra meno
                                                                    </>
                                                                ) : (
                                                                    <>
                                                                        <svg style={{width: '16px', height: '16px', display: 'inline-block', marginRight: '0.5rem'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                                        </svg>
                                                                        Mostra tutte le {calendario.lezioni.length} lezioni
                                                                    </>
                                                                )}
                                                            </button>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CalendarioCorsiApp />, document.getElementById('root'));
    </script>
</body>
</html>
